<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="shortcut icon"
      href="../06_favicon/ccc.png"
      type="image/x-icon"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <title>08_Evolución de Enfermería</title>
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        margin: 20px;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f8ff;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 24px;
      }
      .box-selector {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      .box-selector button {
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background-color: #007bff;
        color: white;
        min-width: 80px;
      }
      .box-selector button.active {
        background-color: #0056b3;
      }
      .formulario {
        width: 100%;
        max-width: 600px;
        margin-bottom: 20px;
      }
      .campo {
        margin-bottom: 15px;
        text-align: center;
      }
      .campo label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
      }
      .campo textarea {
        width: 95%;
        height: 80px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
        resize: none;
      }
      .buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        flex-wrap: wrap;
        gap: 10px;
      }
      .buttons button {
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background-color: #007bff;
        color: white;
        flex-grow: 1;
        min-width: 120px;
      }
      .resultado {
        margin-top: 20px;
        padding: 20px;
        font-family: "Montserrat", sans-serif;
        font-size: 12px;
        line-height: 1.5;
        display: none;
        background-color: white; /* Añadido para mejor legibilidad al imprimir */
        width: 100%;
        max-width: 600px;
        box-sizing: border-box;
      }
      .resultado b {
        font-weight: bold;
      }
      .resultado.turno-nocturno {
        display: flex !important;
        flex-direction: column-reverse;
        justify-content: flex-end;
      }

      /* Nuevos estilos para el selector de box */
      .fecha-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 10px 0;
        flex-wrap: wrap;
      }

      .fecha-container label {
        font-weight: bold;
        font-family: "Montserrat", sans-serif;
      }

      .box-selector-dropdown {
        padding: 8px 12px;
        font-family: "Montserrat", sans-serif;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: white;
      }

      .cargar-fecha-btn {
        padding: 8px 15px;
        font-family: "Montserrat", sans-serif;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      @media (max-width: 480px) {
        .fecha-container {
          flex-direction: column;
          align-items: flex-start;
        }
      }
      /* Fin de Nuevos estilos para el selector de box */

      /* Estilos para la sección de fecha */
      #fechaSeleccionada,
      #fechaSeleccionada + button {
        font-family: "Montserrat", sans-serif;
        font-size: 14px;
      }

      #fechaSeleccionada {
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      /* ESTILOS DE IMPRESIÓN MEJORADOS */
      @media print {
        @page {
          size: A4 portrait;
          margin: 0;
        }

        body {
          margin: 0 !important;
          padding: 0 !important;
          visibility: visible;
          height: 100vh;
        }

        body > *:not(.resultado) {
          display: none !important;
        }

        .resultado {
          visibility: visible !important;
          display: block !important;
          position: relative;
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 20px;
          background: white !important;
          font-size: 12px !important;
          box-sizing: border-box;
          font-family: "Montserrat", sans-serif;
        }

        /* Contenedor especial para turno nocturno */
        .nocturno-print-container {
          position: absolute;
          bottom: 2cm;
          left: 3cm;
          right: 1cm;
        }

        .resultado p {
          page-break-inside: avoid;
          margin: 5px 0;
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        h1 {
          font-size: 20px;
        }
        .box-selector button {
          font-size: 12px;
          padding: 8px 12px;
        }
        .campo label {
          font-size: 14px;
        }
        .campo textarea {
          font-size: 12px;
          height: 60px;
        }
        .buttons button {
          font-size: 12px;
          padding: 8px 12px;
        }
      }
      @media (max-width: 480px) {
        h1 {
          font-size: 18px;
        }
        .box-selector button {
          font-size: 10px;
          padding: 6px 10px;
        }
        .campo label {
          font-size: 12px;
        }
        .campo textarea {
          font-size: 10px;
          height: 50px;
        }
        .buttons button {
          font-size: 10px;
          padding: 6px 10px;
        }
      }
    </style>
  </head>
  <body>
    <h1>08_Evolución de Enfermería</h1>

    <!-- Selector de Box/Paciente -->
    <div class="box-selector">
      <script>
        for (let i = 1; i <= 12; i++) {
          document.write(`<button onclick="selectBox(${i})">Box ${i}</button>`);
        }
      </script>
    </div>

    <!-- Formulario dinámico -->
    <form class="formulario" id="formulario">
      <div class="campo">
        <label for="neurologico">1. NEUROLÓGICO</label>
        <textarea
          id="neurologico"
          placeholder="Ej. Consciente, orientado, RASS 0, sin cambios."
        ></textarea>
      </div>
      <div class="campo">
        <label for="cardiovascular">2. CARDIOVASCULAR</label>
        <textarea
          id="cardiovascular"
          placeholder="Ej. PAM 75 mmHg, FC 88 lpm, sin uso de aminas."
        ></textarea>
      </div>
      <div class="campo">
        <label for="respiratorio">3. RESPIRATORIO</label>
        <textarea
          id="respiratorio"
          placeholder="Ej. FiO₂ 40%, SatO₂ 98%, FR 16 rpm."
        ></textarea>
      </div>
      <div class="campo">
        <label for="renal">4. RENAL</label>
        <textarea
          id="renal"
          placeholder="Ej. Diuresis conservada, sin requerimientos."
        ></textarea>
      </div>
      <div class="campo">
        <label for="gastrointestinal">5. GASTROINTESTINAL</label>
        <textarea
          id="gastrointestinal"
          placeholder="Ej. Abdomen blando, buena tolerancia enteral."
        ></textarea>
      </div>
      <div class="campo">
        <label for="nutricional">6. NUTRICIONAL/METABÓLICO</label>
        <textarea
          id="nutricional"
          placeholder="Ej. Nutrición enteral a buena velocidad, sin vómitos."
        ></textarea>
      </div>
      <div class="campo">
        <label for="termorregulacion">7. TERMORREGULACIÓN</label>
        <textarea
          id="termorregulacion"
          placeholder="Ej. Afebril, temperatura estable."
        ></textarea>
      </div>
      <div class="campo">
        <label for="piel">8. PIEL</label>
        <textarea
          id="piel"
          placeholder="Ej. Buena integridad cutánea, sin lesiones."
        ></textarea>
      </div>
      <div class="campo">
        <label for="otros">9. OTROS</label>
        <textarea
          id="otros"
          placeholder="Ej. Familia presente, sin novedades."
        ></textarea>
      </div>
    </form>

    <!-- Botones de acción -->
    <div class="buttons">
      <button onclick="generarInforme()">Generar Informe</button>
      <button onclick="imprimirAuto()">Imprimir</button>
      <button onclick="borrarDatos()">Borrar Datos</button>
    </div>

    <!-- Modificamos la sección de carga por fecha -->
    <div class="fecha-container">
      <label for="fechaSeleccionada"><strong>Seleccionar fecha:</strong></label>
      <input type="date" id="fechaSeleccionada" value="" />

      <select class="box-selector-dropdown" id="boxSeleccionado">
        <option value="">Seleccionar Box</option>
        <script>
          for (let i = 1; i <= 12; i++) {
            document.write(`<option value="${i}">Box ${i}</option>`);
          }
        </script>
      </select>

      <button class="cargar-fecha-btn" onclick="cargarDatosFecha()">
        Cargar Fecha
      </button>
    </div>

    <!-- Área de resultados -->
    <div class="resultado" id="resultado"></div>

    <script>
      const hoy = new Date().toISOString().slice(0, 10);
      let selectedBox = 1;
      const campos = [
        "neurologico",
        "cardiovascular",
        "respiratorio",
        "renal",
        "gastrointestinal",
        "nutricional",
        "termorregulacion",
        "piel",
        "otros",
      ];

      function getKey(box) {
        return `evolucion_${hoy}_box${box}`;
      }

      function guardarDatos() {
        const datos = {};
        campos.forEach(
          (campo) => (datos[campo] = document.getElementById(campo).value)
        );
        localStorage.setItem(getKey(selectedBox), JSON.stringify(datos));
      }

      function cargarDatos() {
        const data = localStorage.getItem(getKey(selectedBox));
        if (data) {
          const datos = JSON.parse(data);
          campos.forEach(
            (campo) =>
              (document.getElementById(campo).value = datos[campo] || "")
          );
        } else {
          campos.forEach(
            (campo) => (document.getElementById(campo).value = "")
          );
        }
      }

      function selectBox(boxNumber) {
        guardarDatos();
        selectedBox = boxNumber;
        cargarDatos();
        // Actualizar botón activo
        document.querySelectorAll(".box-selector button").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent === `Box ${boxNumber}`)
            btn.classList.add("active");
        });
      }

      function generarInforme(turno = "") {
        guardarDatos();
        const datos = {};
        campos.forEach(
          (campo) =>
            (datos[campo] =
              document.getElementById(campo).value || "No especificado")
        );

        // Eliminamos la obtención de la hora que ya no necesitamos
        const informe = `
                <p><strong>BOX ${selectedBox} - ${turno}</strong></p>
                ${campos
                  .map(
                    (campo) =>
                      `<p><strong>${campo.toUpperCase()}:</strong> ${
                        datos[campo]
                      }</p>`
                  )
                  .join("")}
            `;

        const resultado = document.getElementById("resultado");
        resultado.innerHTML = informe;
        resultado.style.display = "block";
      }
      function imprimirAuto() {
        const esTurnoDiurno =
          new Date().getHours() >= 8 && new Date().getHours() < 20;
        const turno = esTurnoDiurno
          ? "Turno de 8 a 20 horas"
          : "Turno de 20 a 8 horas";

        generarInforme(turno);

        const resultado = document.getElementById("resultado");
        resultado.style.display = "block";

        if (!esTurnoDiurno) {
          // Para turno nocturno: envolver el contenido en un contenedor especial
          const contenido = resultado.innerHTML;
          resultado.innerHTML = `
                    <div class="nocturno-print-container">
                        ${contenido}
                    </div>
                `;
        }

        // Forzar renderizado antes de imprimir
        void resultado.offsetHeight;

        setTimeout(() => {
          window.print();

          // Restaurar el contenido original después de imprimir
          if (!esTurnoDiurno) {
            const contenedorNocturno = resultado.querySelector(
              ".nocturno-print-container"
            );
            if (contenedorNocturno) {
              resultado.innerHTML = contenedorNocturno.innerHTML;
            }
          }

          resultado.style.display = "none";
        }, 100);
      }
      function borrarDatos() {
        localStorage.removeItem(getKey(selectedBox));
        cargarDatos();
      }

      function cargarDatosFecha() {
        const fecha = document.getElementById("fechaSeleccionada").value;
        const boxSeleccionado =
          document.getElementById("boxSeleccionado").value;

        if (!fecha) return alert("Seleccione una fecha.");
        if (!boxSeleccionado) return alert("Seleccione un box.");

        const key = `evolucion_${fecha}_box${boxSeleccionado}`;
        const data = localStorage.getItem(key);

        if (data) {
          const datos = JSON.parse(data);
          campos.forEach(
            (campo) =>
              (document.getElementById(campo).value = datos[campo] || "")
          );
          selectedBox = boxSeleccionado; // Actualizamos el box seleccionado
          actualizarBotonesBox();
          alert(`Datos del ${fecha} cargados para Box ${boxSeleccionado}`);
        } else {
          alert(
            `No hay datos guardados para el ${fecha} en Box ${boxSeleccionado}`
          );
        }
      }

      function actualizarBotonesBox() {
        document.querySelectorAll(".box-selector button").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent === `Box ${selectedBox}`) {
            btn.classList.add("active");
          }
        });
      }

      window.onload = () => selectBox(1);
    </script>
  </body>
</html>
