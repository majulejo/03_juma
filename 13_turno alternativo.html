<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>13_Evolución de Enfermería</title>
    <style>
      /* [Todos los estilos anteriores se mantienen igual] */
      body {
        font-family: "Montserrat", sans-serif;
        margin: 20px;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f8ff;
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .box-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 800px;
      }

      .box-btn {
        width: 80px;
        height: 40px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        text-align: center;
        line-height: 40px;
      }

      .box-btn.active {
        background-color: #0056b3;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .form-container {
        width: 100%;
        max-width: 800px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .form-group textarea {
        width: 100%;
        height: 80px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        resize: vertical;
        font-family: "Montserrat", sans-serif;
      }

      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 20px 0;
      }

      .action-btn {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-family: "Montserrat", sans-serif;
      }

      .date-selector {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .date-selector label {
        font-weight: bold;
      }

      #fecha {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-family: "Montserrat", sans-serif;
      }

      /* Selector de Box personalizado */
      .custom-select-wrapper {
        position: relative;
        width: 150px;
      }

      .select-box {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        cursor: pointer;
        text-align: center;
        font-weight: bold;
      }

      .box-options {
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px 5px 0 0;
        max-height: 200px;
        overflow-y: auto;
        display: none;
        z-index: 10;
        box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 5px;
      }

      .box-option {
        padding: 10px;
        cursor: pointer;
        text-align: center;
        border-bottom: 1px solid #eee;
      }

      .box-option:hover {
        background-color: #f0f8ff;
      }

      .result-container {
        display: none;
        width: 100%;
        max-width: 800px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        margin-top: 20px;
      }

      .printable-area {
        font-size: 10pt;
        line-height: 1.4;
      }
      /* Nuevo estilo para el botón de impresión alternativa */
      .alternate-print-btn {
        padding: 10px 20px;
        background-color: #ffc107;
        color: #212529;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-family: "Montserrat", sans-serif;
        margin-left: 10px;
      }

      /* Estilos de impresión optimizados con margen izquierdo de 3cm */
      @media print {
        @page {
          size: A4;
          margin: 0; /* Elimina márgenes predeterminados */
        }

        body * {
          display: none !important;
          visibility: hidden !important;
        }

        .printable-area,
        .printable-area * {
          display: block !important;
          visibility: visible !important;
          position: absolute;
          width: 90%;
          left: 5%;
          font-size: 12pt;
          line-height: 1.4;
        }

        .turno-diurno {
          top: 2cm; /* Posiciona el informe diurno en la parte superior */
        }

        .turno-nocturno {
          bottom: 2cm; /* Posiciona el informe nocturno en la parte inferior */
        }
      }
    </style>
  </head>
  <body>
    <h1>13_Evolución de Enfermería</h1>

    <div class="box-container" id="boxContainer">
      <!-- Botones de Box se generarán aquí -->
    </div>

    <div class="form-container">
      <div class="form-group">
        <label for="neurologico">1. NEUROLÓGICO</label>
        <textarea
          id="neurologico"
          placeholder="Ej. Consciente, orientado, RASS 0, sin cambios."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="cardiovascular">2. CARDIOVASCULAR</label>
        <textarea
          id="cardiovascular"
          placeholder="Ej. PAM 75 mmHg, FC 88 lpm, sin uso de aminas."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="respiratorio">3. RESPIRATORIO</label>
        <textarea
          id="respiratorio"
          placeholder="Ej. FiO₂ 40%, SatO₂ 98%, FR 16 rpm."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="renal">4. RENAL</label>
        <textarea
          id="renal"
          placeholder="Ej. Diuresis conservada, sin requerimientos."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="gastrointestinal">5. GASTROINTESTINAL</label>
        <textarea
          id="gastrointestinal"
          placeholder="Ej. Abdomen blando, buena tolerancia enteral."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="nutricional">6. NUTRICIONAL/METABÓLICO</label>
        <textarea
          id="nutricional"
          placeholder="Ej. Nutrición enteral a buena velocidad, sin vómitos."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="termorregulacion">7. TERMORREGULACIÓN</label>
        <textarea
          id="termorregulacion"
          placeholder="Ej. Afebril, temperatura estable."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="piel">8. PIEL</label>
        <textarea
          id="piel"
          placeholder="Ej. Buena integridad cutánea, sin lesiones."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="otros">9. OTROS</label>
        <textarea
          id="otros"
          placeholder="Ej. Familia presente, sin novedades."
        ></textarea>
      </div>
    </div>
    <!-- [Todo el contenido HTML anterior permanece igual hasta los botones de acción] -->

    <div class="action-buttons">
      <button class="action-btn" id="generarInforme">Generar Informe</button>
      <button class="action-btn" id="imprimirInforme">Imprimir</button>
      <button class="alternate-print-btn" id="imprimirAlternativo">
        Imprimir Turno Alternativo
      </button>
      <button class="action-btn" id="limpiarFormulario">Borrar Datos</button>
    </div>

    <!-- [El resto del HTML permanece igual] -->
    <div class="date-selector">
      <label for="fecha">Seleccionar fecha:</label>
      <input type="date" id="fecha" />

      <div class="custom-select-wrapper">
        <div class="select-box" id="selectBox">Seleccionar Box</div>
        <div class="box-options" id="boxOptions">
          <div class="box-option" data-value="1">Box 1</div>
          <div class="box-option" data-value="2">Box 2</div>
          <div class="box-option" data-value="3">Box 3</div>
          <div class="box-option" data-value="4">Box 4</div>
          <div class="box-option" data-value="5">Box 5</div>
          <div class="box-option" data-value="6">Box 6</div>
          <div class="box-option" data-value="7">Box 7</div>
          <div class="box-option" data-value="8">Box 8</div>
          <div class="box-option" data-value="9">Box 9</div>
          <div class="box-option" data-value="10">Box 10</div>
          <div class="box-option" data-value="11">Box 11</div>
          <div class="box-option" data-value="12">Box 12</div>
        </div>
      </div>

      <button class="action-btn" id="cargarFecha">Cargar Fecha</button>
    </div>

    <div class="result-container" id="resultado"></div>
    <script>
      // Variables globales
      let boxActual = 1;
      let selectedBoxValue = null;
      const campos = [
        "neurologico",
        "cardiovascular",
        "respiratorio",
        "renal",
        "gastrointestinal",
        "nutricional",
        "termorregulacion",
        "piel",
        "otros",
      ];

      // Inicialización
      document.addEventListener("DOMContentLoaded", function () {
        crearBotonesBox();
        setupBoxSelector();
        setupEventListeners();
        seleccionarBox(1);
      });

      function crearBotonesBox() {
        const container = document.getElementById("boxContainer");
        container.innerHTML = "";
        for (let i = 1; i <= 12; i++) {
          const btn = document.createElement("button");
          btn.className = "box-btn";
          btn.textContent = `Box ${i}`;
          btn.onclick = function () {
            seleccionarBox(i); // Llama a la función correcta
          };
          container.appendChild(btn);
        }
      }

      function setupBoxSelector() {
        const selectBox = document.getElementById("selectBox");
        const boxOptions = document.getElementById("boxOptions");
        const options = boxOptions.querySelectorAll(".box-option");

        selectBox.addEventListener("click", function (e) {
          e.stopPropagation();
          boxOptions.style.display =
            boxOptions.style.display === "block" ? "none" : "block";
        });

        options.forEach((option) => {
          option.addEventListener("click", function () {
            selectedBoxValue = this.getAttribute("data-value");
            selectBox.textContent = this.textContent;
            boxOptions.style.display = "none";

            // Actualizar boxActual y seleccionar el box
            const nuevoBox = parseInt(selectedBoxValue);
            if (!isNaN(nuevoBox)) {
              seleccionarBox(nuevoBox); // Llama a la función para actualizar todo
            }
          });
        });

        document.addEventListener("click", function () {
          boxOptions.style.display = "none";
        });
      }

      function setupEventListeners() {
        document
          .getElementById("generarInforme")
          .addEventListener("click", () => {
            generarInforme();
          });
        document
          .getElementById("imprimirInforme")
          .addEventListener("click", imprimirInforme);
        document
          .getElementById("limpiarFormulario")
          .addEventListener("click", limpiarFormulario);
        document
          .getElementById("cargarFecha")
          .addEventListener("click", cargarDatos);
        document
          .getElementById("imprimirAlternativo")
          .addEventListener("click", imprimirInformeAlternativo);
      }

      function seleccionarBox(numeroBox) {
        if (boxActual === numeroBox) return; // Evitar recargar si ya está seleccionado

        guardarDatos(); // Guardar datos del box actual antes de cambiar

        boxActual = numeroBox; // Actualizar boxActual

        // Actualizar botones y selector personalizado
        const botones = document.querySelectorAll(".box-btn");
        botones.forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent === `Box ${numeroBox}`) {
            btn.classList.add("active");
          }
        });

        selectedBoxValue = numeroBox.toString();
        document.getElementById("selectBox").textContent = `Box ${numeroBox}`;

        cargarDatosBox(); // Cargar datos del nuevo box
      }

      function guardarDatos() {
        const datos = {};
        campos.forEach((campo) => {
          datos[campo] = document.getElementById(campo).value;
        });
        // Clave corregida: "box_1", "box_2", etc.
        localStorage.setItem(`box_${boxActual}`, JSON.stringify(datos));
        // Guardar también con fecha actual (opcional)
        const fechaActual = new Date().toISOString().split("T")[0];
        localStorage.setItem(
          `box_${boxActual}_${fechaActual}`,
          JSON.stringify(datos)
        );
      }

      function cargarDatosBox() {
        const datosGuardados = localStorage.getItem(`box_${boxActual}`);
        if (datosGuardados) {
          const datos = JSON.parse(datosGuardados);
          campos.forEach((campo) => {
            document.getElementById(campo).value = datos[campo] || "";
          });
        } else {
          campos.forEach((campo) => {
            document.getElementById(campo).value = "";
          });
        }
      }

      function cargarDatos() {
        const fecha = document.getElementById("fecha").value;
        const box = boxActual; // Usar boxActual en lugar de selectedBoxValue
        if (!fecha || !box) {
          alert("Por favor seleccione una fecha y un box");
          return;
        }
        const clave = `box_${box}_${fecha}`;
        const datosGuardados = localStorage.getItem(clave);
        if (datosGuardados) {
          const datos = JSON.parse(datosGuardados);
          campos.forEach((campo) => {
            document.getElementById(campo).value = datos[campo] || "";
          });
          alert(`Datos del Box ${box} (${fecha}) cargados correctamente`);
        } else {
          alert(
            `No se encontraron datos para el Box ${box} en la fecha ${fecha}`
          );
        }
      }

      // [Variables globales y funciones anteriores permanecen igual hasta imprimirInformeAlternativo]

      function getCurrentShift() {
        const ahora = new Date();
        return ahora.getHours() >= 8 && ahora.getHours() < 20
          ? "diurno"
          : "nocturno";
      }
      function generarInforme(turno = null) {
        guardarDatos();
        const ahora = new Date();
        let esDiurno;
        let turnoTexto;

        if (turno) {
          esDiurno = turno === "diurno";
          turnoTexto = esDiurno
            ? "Turno de 8 a 20 horas"
            : "Turno de 20 a 8 horas";
        } else {
          esDiurno = ahora.getHours() >= 8 && ahora.getHours() < 20;
          turnoTexto = esDiurno
            ? "Turno de 8 a 20 horas"
            : "Turno de 20 a 8 horas";
        }

        let informeHTML = `
    <div class="printable-area ${esDiurno ? "turno-diurno" : "turno-nocturno"}">
      <h3>BOX ${boxActual} - ${turnoTexto}</h3>
  `;

        campos.forEach((campo) => {
          const valor =
            document.getElementById(campo).value || "No especificado";
          informeHTML += `<p><strong>${campo.toUpperCase()}:</strong> ${valor}</p>`;
        });

        informeHTML += `</div>`;
        document.getElementById("resultado").innerHTML = informeHTML;
        document.getElementById("resultado").style.display = "block";
      }

      function imprimirInforme() {
        generarInforme();

        requestAnimationFrame(() => {
          // Ocultar elementos externos al informe
          document
            .querySelectorAll("body > *:not(#resultado)")
            .forEach((el) => {
              el.style.display = "none";
            });

          // Imprimir después de un breve retraso
          setTimeout(() => {
            window.print();

            // Restaurar la vista original
            setTimeout(() => {
              document.querySelectorAll("body > *").forEach((el) => {
                el.style.display = "";
              });
              document.getElementById("resultado").style.display = "none";
            }, 100);
          }, 50); // Espera 50ms para asegurar que el DOM se renderice
        });
      }

      function imprimirInformeAlternativo() {
        const turnoActual = getCurrentShift();
        const turnoOpuesto = turnoActual === "diurno" ? "nocturno" : "diurno";
        generarInforme(turnoOpuesto);

        requestAnimationFrame(() => {
          document
            .querySelectorAll("body > *:not(#resultado)")
            .forEach((el) => {
              el.style.display = "none";
            });
          window.print();

          setTimeout(() => {
            document.querySelectorAll("body > *").forEach((el) => {
              el.style.display = "";
            });
            document.getElementById("resultado").style.display = "none";
          }, 100);
        });
      }
      // En la inicialización, agregar el event listener para el nuevo botón
      document.addEventListener("DOMContentLoaded", function () {
        crearBotonesBox();
        setupBoxSelector();
        setupEventListeners();
        seleccionarBox(1);

        // Agregar evento para el botón de impresión alternativa
        document
          .getElementById("imprimirAlternativo")
          .addEventListener("click", imprimirInformeAlternativo);
      });

      function setupEventListeners() {
        document
          .getElementById("generarInforme")
          .addEventListener("click", function () {
            generarInforme();
          });
        document
          .getElementById("imprimirInforme")
          .addEventListener("click", imprimirInforme);
        document
          .getElementById("limpiarFormulario")
          .addEventListener("click", limpiarFormulario);
        document
          .getElementById("cargarFecha")
          .addEventListener("click", cargarDatos);
      }

      // [El resto de las funciones permanece igual]
      // Esperar un momento para que se genere el contenido antes de imprimir
      setTimeout(() => {
        window.print();
      }, 100);

      function limpiarFormulario() {
        if (confirm("¿Está seguro que desea borrar todos los datos?")) {
          campos.forEach((campo) => {
            document.getElementById(campo).value = "";
          });
        }
      }
    </script>
  </body>
</html>
