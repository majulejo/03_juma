<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>14_turno alternativo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      h1 {
        text-align: center;
        color: #2c3e50;
        font-size: 1.5em;
        margin-bottom: 15px;
      }
      .box-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
        justify-content: center;
      }
      .box-btn {
        padding: 8px 12px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
      }
      .box-btn.active {
        background-color: #2980b9;
        font-weight: bold;
      }
      .form-container {
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .campo {
        margin-bottom: 10px;
      }
      .campo label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: #34495e;
        font-size: 0.9em;
      }
      .campo textarea {
        width: 95%;
        height: 70px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
        font-size: 0.9em;
      }
      .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 20px 0px;
      }
      .action-btn {
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        flex: 1;
        min-width: 140px;
        font-size: 0.9em;
      }
      .primary-btn {
        background-color: #2ecc71;
        color: white;
      }
      .secondary-btn {
        background-color: #e74c3c;
        color: white;
      }
      .date-container {
        background-color: #ecf0f1;
        padding: 12px;
        border-radius: 6px;
        margin-top: 15px;
        font-size: 0.9em;
      }
      #resultado {
        margin-top: 15px;
        padding: 15px;
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: none;
        font-size: 0.9em;
      }

      @media print {
        @page {
          margin: 0;
        }
        body > *:not(#resultado) {
          display: none !important;
        }
        #resultado {
          display: block !important;
          margin: 0;
          padding: 0 1cm !important;
          border: none;
        }
        .nocturno {
          position: fixed;
          bottom: 2cm;
          left: 1cm;
          right: 1cm;
        }
      }
    </style>
  </head>
  <body>
    <h1>14_turno alternativo</h1>

    <div class="box-container" id="boxButtons">
      <!-- Botones de Box se generan con JS -->
    </div>

    <div class="form-container">
      <div class="campo">
        <label for="neurologico">1. NEUROLÓGICO</label>
        <textarea
          id="neurologico"
          placeholder="Ej. Consciente, orientado..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="cardiovascular">2. CARDIOVASCULAR</label>
        <textarea
          id="cardiovascular"
          placeholder="Ej. PAM 75 mmHg, FC 88 lpm..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="respiratorio">3. RESPIRATORIO</label>
        <textarea
          id="respiratorio"
          placeholder="Ej. FiO₂ 40%, SatO₂ 98%..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="renal">4. RENAL</label>
        <textarea
          id="renal"
          placeholder="Ej. Diuresis conservada..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="gastrointestinal">5. GASTROINTESTINAL</label>
        <textarea
          id="gastrointestinal"
          placeholder="Ej. Abdomen blando..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="nutricional">6. NUTRICIONAL/METABÓLICO</label>
        <textarea
          id="nutricional"
          placeholder="Ej. Nutrición enteral..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="termorregulacion">7. TERMORREGULACIÓN</label>
        <textarea id="termorregulacion" placeholder="Ej. Afebril..."></textarea>
      </div>
      <div class="campo">
        <label for="piel">8. PIEL</label>
        <textarea
          id="piel"
          placeholder="Ej. Buena integridad cutánea..."
        ></textarea>
      </div>
      <div class="campo">
        <label for="otros">9. OTROS</label>
        <textarea id="otros" placeholder="Ej. Familia presente..."></textarea>
      </div>

      <div class="action-buttons">
        <button class="action-btn primary-btn" onclick="generarInforme()">
          Generar Informe
        </button>
        <button class="action-btn primary-btn" onclick="imprimirInforme()">
          Imprimir
        </button>
        <button
          class="action-btn primary-btn"
          onclick="imprimirTurnoAlternativo()"
        >
          Imprimir Turno Alternativo
        </button>
        <button class="action-btn secondary-btn" onclick="borrarDatos()">
          Borrar Datos
        </button>
      </div>

      <div class="date-container">
        <label><strong>Seleccionar fecha:</strong></label>
        <input type="date" id="fechaSeleccionada" />
        <select id="boxSeleccionado">
          <option value="">Seleccionar Box</option>
          <!-- Opciones de Box se generan con JS -->
        </select>
        <button class="action-btn primary-btn" onclick="cargarDatosFecha()">
          Cargar Informe
        </button>
      </div>
    </div>

    <div id="resultado"></div>

    <script>
      // Variables globales
      let currentBox = 1;
      const campos = [
        "neurologico",
        "cardiovascular",
        "respiratorio",
        "renal",
        "gastrointestinal",
        "nutricional",
        "termorregulacion",
        "piel",
        "otros",
      ];

      // Inicialización
      document.addEventListener("DOMContentLoaded", function () {
        // Generar botones de Box (1-12)
        const boxContainer = document.getElementById("boxButtons");
        const boxSelect = document.getElementById("boxSeleccionado");

        for (let i = 1; i <= 12; i++) {
          // Botones de selección rápida
          const btn = document.createElement("button");
          btn.className = "box-btn";
          btn.textContent = `Box ${i}`;
          btn.onclick = () => seleccionarBox(i);
          boxContainer.appendChild(btn);

          // Opciones para el selector de carga por fecha
          const option = document.createElement("option");
          option.value = i;
          option.textContent = `Box ${i}`;
          boxSelect.appendChild(option);
        }

        // Establecer fecha actual
        document.getElementById("fechaSeleccionada").valueAsDate = new Date();

        // Cargar datos iniciales del Box 1
        seleccionarBox(1);
      });

      // Función para seleccionar un Box
      function seleccionarBox(box) {
        // Guardar datos del Box actual antes de cambiar
        guardarDatos();

        // Cambiar al nuevo Box
        currentBox = box;

        // Actualizar botones activos
        document.querySelectorAll(".box-btn").forEach((btn) => {
          btn.classList.toggle("active", btn.textContent === `Box ${box}`);
        });

        // Cargar datos del nuevo Box
        cargarDatos();
      }

      // Función para generar el informe (vista previa)
      function generarInforme() {
        const turno = esTurnoNocturno()
          ? "Turno de 20 a 8 horas"
          : "Turno de 8 a 20 horas";

        let informeHTML = `<h2>BOX ${currentBox} - ${turno}</h2>`;

        campos.forEach((campo) => {
          const valor =
            document.getElementById(campo).value.trim() || "No especificado";
          informeHTML += `<p><strong>${campo.toUpperCase()}:</strong> ${valor}</p>`;
        });

        const resultado = document.getElementById("resultado");
        resultado.innerHTML = informeHTML;
        resultado.style.display = "block";
      }

      // Función para imprimir el informe según turno actual
      function imprimirInforme() {
        generarInforme();
        const resultado = document.getElementById("resultado");

        if (esTurnoNocturno()) {
          resultado.classList.add("nocturno");
        } else {
          resultado.classList.remove("nocturno");
        }

        setTimeout(() => {
          window.print();
        }, 300);
      }

      // Función para imprimir turno alternativo
      function imprimirTurnoAlternativo() {
        generarInforme();
        const resultado = document.getElementById("resultado");

        // Invertir el turno actual
        if (esTurnoNocturno()) {
          resultado.classList.remove("nocturno");
          resultado.querySelector(
            "h2"
          ).textContent = `BOX ${currentBox} - Turno de 8 a 20 horas`;
        } else {
          resultado.classList.add("nocturno");
          resultado.querySelector(
            "h2"
          ).textContent = `BOX ${currentBox} - Turno de 20 a 8 horas`;
        }

        setTimeout(() => {
          window.print();
        }, 300);
      }

      // Función para guardar datos en localStorage
      function guardarDatos() {
        const datos = {};
        const fechaActual = document.getElementById("fechaSeleccionada").value;

        campos.forEach((campo) => {
          datos[campo] = document.getElementById(campo).value;
        });

        localStorage.setItem(
          `evolucion_${fechaActual}_box${currentBox}`,
          JSON.stringify(datos)
        );
      }

      // Función para cargar datos del Box actual
      function cargarDatos() {
        const fechaActual = document.getElementById("fechaSeleccionada").value;
        const datos =
          JSON.parse(
            localStorage.getItem(`evolucion_${fechaActual}_box${currentBox}`)
          ) || {};

        campos.forEach((campo) => {
          document.getElementById(campo).value = datos[campo] || "";
        });
      }

      // Función para cargar datos por fecha y box seleccionado
      function cargarDatosFecha() {
        const fecha = document.getElementById("fechaSeleccionada").value;
        const box = document.getElementById("boxSeleccionado").value;

        if (!fecha || !box) {
          alert("Por favor selecciona una fecha y un box");
          return;
        }

        const datos = JSON.parse(
          localStorage.getItem(`evolucion_${fecha}_box${box}`)
        );

        if (datos) {
          currentBox = parseInt(box);
          document.querySelectorAll(".box-btn").forEach((btn) => {
            btn.classList.toggle("active", btn.textContent === `Box ${box}`);
          });

          campos.forEach((campo) => {
            document.getElementById(campo).value = datos[campo] || "";
          });

          alert(`Datos cargados para Box ${box} del ${fecha}`);
        } else {
          alert(`No se encontraron datos para Box ${box} del ${fecha}`);
        }
      }

      // Función para borrar datos del Box actual
      function borrarDatos() {
        if (confirm("¿Borrar los datos del Box actual?")) {
          campos.forEach((campo) => {
            document.getElementById(campo).value = "";
          });
        }
      }

      // Función auxiliar para determinar si es turno nocturno (20:00-8:00, hora Madrid)
      function esTurnoNocturno() {
        const ahora = new Date();
        // Ajustar a hora de Madrid (UTC+1/+2)
        const horaMadrid = new Date(
          ahora.toLocaleString("es-ES", { timeZone: "Europe/Madrid" })
        );
        const horas = horaMadrid.getHours();
        return horas >= 20 || horas < 8;
      }
    </script>
  </body>
</html>
